<!DOCTYPE html>
<html>
	<head>
		<!--<meta name="renderer" content="webkit|ie-comp|ie-stand">-->
		<meta name="renderer" content="webkit" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta charset="utf-8">
		<title>好活平台</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.5 -->
		<link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">

		<!-- Font Awesome -->
		<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">-->
		<link rel="stylesheet" href="../../dist/css/font-awesome.min.css">
		<!-- Ionicons -->
		<!--<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">-->
		<!-- Theme style -->
		<!--<link rel="stylesheet" href="http://dist.51haohuo.net/dist/css/AdminLTE-short.css">-->
		<link rel="stylesheet" href="../../plugins/select2/select2.min.css">
		<link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load.
    <link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">-->
		<link rel="stylesheet" href="../../dist/css/skins/skin-orange.css">
		<!-- iCheck-->
		<link rel="stylesheet" href="../../plugins/iCheck/square/blue.css">
		<link rel="stylesheet" href="../../plugins/sweetalert/css/sweetalert.css">
		<!-- Morris chart -->
		<!--<link rel="stylesheet" href="../../plugins/morris/morris.css">-->
		<!-- jvectormap -->
		<!--<link rel="stylesheet" href="../../plugins/jvectormap/jquery-jvectormap-1.2.2.css">-->
		<!-- Date Picker -->
		<link rel="stylesheet" href="//dist.51haohuo.com/plugins/datepicker/datepicker3.css">
		<!-- Daterange picker -->
		<!--<link rel="stylesheet" href="../../plugins/daterangepicker/daterangepicker-bs3.css">-->
		<!-- bootstrap wysihtml5 - text editor -->
		<!--<link rel="stylesheet" href="../../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">-->

		<!--<link rel="stylesheet" href="../../plugins/twitter-bootstrap-wizard-master/prettify.css">-->


		<link rel="stylesheet" href="//dist.51haohuo.com/plugins/bootstrapValidator/css/bootstrapValidator.css" />
		<link rel="icon" href="//dist.51haohuo.com/dist/img/logo.ico" type="image/x-icon" />


		<!-- iCheck-->
		<!--<link rel="stylesheet" href="../../plugins/iCheck/square/blue.css">-->

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	</head>
	<script src="../../controllers/register.js"></script>
	<link rel="stylesheet" href="../../dist/css/logon.css" />
	<style>
		.col-xs-4 span {
        line-height: 36px;
    }
    .nav-pills>li.active>a, .nav-pills>li.active>a:focus, .nav-pills>li.active>a:hover {
        color: #FF751A !important;
        border-top-color: #FF751A !important;
        background-color: #ffffff !important;
    }
    .step li {
        width: 33%;
        float: left;
        background-color: #fff;
        box-shadow: 1px 1px 2px #ddd;}
    span.title{
        height:23px;
        font-size:24px;
        font-family:MicrosoftYaHei;
        font-weight:400;
        color:rgba(51,51,51,1);
        line-height:33px;
    }
</style>
	<body class="hold-transition login-page">
		<input type="hidden" value="">
		<input type="hidden" id="hidflag" name="hidflag" value="1">
		<header id="header">
			<nav>
				<img src="../../dist/img/Newlogo.png" />
				<span class="title">欢迎登录!</span>
				<span class="phoneNew">客服电话：400-706-2828</span>
			</nav>
		</header>
		<div class="loginContainer">
			<div class="loginBox" style="width:1100px; margin: 0 auto;">
				<!--<div class="slideBox" id="release">-->
				<!--<div class="hd">-->
				<!--<ul>-->
				<!--<li class="on"></li>-->
				<!--<li class=""></li>-->
				<!--</ul>-->
				<!--</div>-->
				<!--<div class="bannerWrapper">-->
				<!--<ul class="banner">-->
				<!--<li>-->
				<!--<img src="../../dist/img/1.png"/>-->
				<!--<li>-->
				<!--<img src="../../dist/img/2.png"/>-->
				<!--</li>-->
				<!--</ul>-->
				<!--</div>-->
				<!--</div>-->
				<div class="slideBox">
					<img src="../../dist/img/ntxt.png" style="margin-top: 200px;" />
				</div>
				<div class="loginContent">
					<div class="mainHeader">好活账号登录</div>
					<div class="inputBox">
						<form action="./login" method="post">
							<label>手机号</label>
							<input id='name' name='name' placeholder="请输入已注册的手机号" />
							<label>密码</label>
							<input id='pass' name='pass' type="password" placeholder="请输入您的密码" />
							<!--<div class="checkbox icheck" style=" width: 35%; margin-left: 15%; float: left;">-->
							<!--<label class="remember">-->
							<!--<input type="checkbox"> 记住我-->
							<!--</label>-->
							<!--</div>-->
							<!--<a class="forget">忘记密码？</a>-->
							<!--<a class="logon" type="submit">登录</a>-->
							<p style="color: #ff0000;display: block; float: left; text-align: center;width: 100%;" class="login-box-msg">
							</p>
							<button type="submit" class="logon">登 录</button>
							<a class="forgetPsw" id="forgetPsw" style="cursor: pointer;float: left;margin-top: 20px">忘记密码</a>
							<a href="/register" target="_blank" class="register" style="float: right;margin-top: 20px;text-decoration:none;">立即注册</a>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- 验证码弹窗（Modal） -->
		<div class="modal fade" id="regModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" id="regDialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
						</button>
						<h4 class="modal-title" id="searchCpLabel">
							忘记密码
						</h4>
					</div>
					<div class="modal-body" id="searchCpBody" style="height: 320px;">
						<div class="modal-body" id="importTargetBody">
							<div id="rootwizard">
								<div class="navbar">
									<ul class="step">
										<li><a href="#tab1" data-toggle="tab">填写手机号</a></li>
										<li><a href="#tab2" data-toggle="tab">验证手机</a></li>
										<li><a href="#tab3" data-toggle="tab">重置密码</a></li>
									</ul>
								</div>
								<div class="tab-content">
									<div class="tab-pane " id="tab1">
										<span style="display: block;font-size: 16px;">忘记了密码？</span>
										<span style="display: block;;">没关系，只要手机在您身旁随时找回您的密码</span>
										<div class="col-md-12 no-padding" style="margin-top:20px ">
											<span style="line-height: 36px;">请输入您的登录手机号：</span>
										</div>
										<div class="col-md-12 no-padding">
											<div class="col-xs-4 form-group no-padding">
												<input id="phoneNo" placeholder="请输入您的手机号" name="phoneNo" class="form-control" />
											</div>
										</div>
									</div>
									<div class="tab-pane" id="tab2">
										<div class="col-md-12" id="pointTaskBox">
											<div class="col-xs-8">
												<div class="col-xs-4 no-padding">
													<span>图形验证码：</span>
												</div>
												<div class="col-xs-8 form-group no-padding" style="line-height: 24px;">
													<input id="regCode" name="regCode" class="form-control" />
												</div>
											</div>
											<div class="col-xs-4 no-padding">
												<img id="codeBox" style="width: 80px;" />
												<a class="update" style="cursor: pointer; margin-left: 20px;">刷新</a>
											</div>
										</div>
										<div class="col-md-12">
											<div class="col-xs-8">
												<div class="col-xs-4 no-padding">
													<span>短信验证码：</span>
												</div>
												<div class="col-xs-8 form-group no-padding" style="line-height: 24px;">
													<input id="msgCode" placeholder="请输入短信验证码" name="msgCode" class="form-control" />
												</div>
											</div>
											<div class="col-xs-4 no-padding">
												<button id="getMsgCode" class="btn btn-submit" style="width: 140px;">获取短信验证码</button>
											</div>
										</div>
									</div>
									<div class="tab-pane" id="tab3">
										<span style="display: block;margin-bottom: 20px;">请输入6-12位数字或字母的组合</span>
										<div class="col-md-12">
											<div class="col-xs-8">
												<div class="col-xs-4 no-padding">
													<span>输入新密码：</span>
												</div>
												<div class="col-xs-8 form-group no-padding" style="line-height: 24px;">
													<input id="newPsw" placeholder="请输入密码" type="password" name="newPsw" class="form-control" />
												</div>
											</div>
										</div>
										<div class="col-md-12">
											<div class="col-xs-8">
												<div class="col-xs-4 no-padding">
													<span>重新输入新密码：</span>
												</div>
												<div class="col-xs-8 form-group no-padding" style="line-height: 24px;">
													<input id="newPswAgain" placeholder="请再次输入密码" type="password" name="newPswAgain" class="form-control" />
												</div>
											</div>
										</div>
									</div>
									<ul class="pager wizard">
										<!--<li class="previous first" style="display:none;"><a href="javascript:;">First</a></li>-->
										<!--<li class="previous" style="display: none" id="upli"><button id="upSteps"  class="btn btn-submit" href="javascript:;">上一步</button></li>-->
										<button type="button" class="btn btn-default" data-dismiss="modal">
											取消
										</button>
										<li class="next last" style="display:none;"><a href="javascript:;">Last</a></li>
										<li class="next" id="linextSteps"><button id="nextSteps" class="btn btn-submit" href="javascript:;">下一步</button></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<!--<div class="modal-footer">-->
					<!--<button type="button" class="btn btn-default" data-dismiss="modal">-->
					<!--取消-->
					<!--</button>-->
					<!--<button type="button" id="updatePsw" class="btn btn-submit" data-dismiss="modal">-->
					<!--确定-->
					<!--</button>-->
					<!--</div>-->
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<!--<footer class="">-->
		<!--<p>© 北京众志好活科技有限公司 2015-2016</p>-->
		<!--<p><a href="http://www.miitbeian.gov.cn/" target="_blank">京ICP备140357173号-3</a></p>-->
		<!--</footer>-->
		<!--<div class="login-logo">-->
		<!--<a href="#"><b>好活平台</b><br />企业版</a>-->
		<!--</div>-->
		<!-- /.login-logo -->
		<!--<div class="login-box-body">-->

		<!--<p class="login-box-msg">  </p>-->

		<!--<form action="./login" method="post">-->
		<!--<div class="form-group has-feedback">-->
		<!--<input type="label" id='name' name='name' class="form-control" placeholder="账号">-->
		<!--<span class="glyphicon glyphicon-user form-control-feedback"></span>-->
		<!--</div>-->
		<!--<div class="form-group has-feedback">-->
		<!--<input type="password" id='pass' name='pass' class="form-control" placeholder="密码">-->
		<!--<span class="glyphicon glyphicon-lock form-control-feedback"></span>-->
		<!--</div>-->
		<!--<div class="row">-->
		<!--<div class="col-xs-8 hidden">-->
		<!--<div class="checkbox icheck">-->
		<!--<label>-->
		<!--<input type="checkbox"> 记住我-->
		<!--</label>-->
		<!--</div>-->
		<!--</div>-->
		<!--&lt;!&ndash; /.col &ndash;&gt;-->
		<!--<div class="col-xs-12">-->
		<!--<button type="submit" class="btn btn-primary btn-block btn-flat">登 录</button>-->
		<!--</div>-->
		<!--&lt;!&ndash; /.col &ndash;&gt;-->
		<!--</div>-->
		<!--<div class="row">-->
		<!--<div class="col-xs-12">-->
		<!--&lt;!&ndash; <a href="#" class="text-center">忘记密码</a>&ndash;&gt;-->
		<!--<a href="./register" class="text-center" style="float: right;margin-top: 5px;">注册新用户</a>-->
		<!--</div>-->
		<!--</div>-->
		<!--</form>-->

		<!--
<div class="social-auth-links text-center">
  <p>- OR -</p>
  <a href="#" class="btn btn-block btn-social btn-facebook btn-flat"><i class="fa fa-facebook"></i> Sign in using
    Facebook</a>
  <a href="#" class="btn btn-block btn-social btn-google btn-flat"><i class="fa fa-google-plus"></i> Sign in using
    Google+</a>
</div>
-->
		<!-- /.social-auth-links -->


		<!-- /.login-box-body -->

		<!-- /.login-box -->

		<!-- jQuery 2.1.4 -->
		<script src="../../plugins/jQuery/jQuery-2.1.4.min.js"></script>
		<!--[if lt IE 9]>
<script src="../../plugins/jQuery/jquery-1.11.3.min.js"></script>
<![endif]-->
		<!-- Bootstrap 3.3.5 -->
		<script src="../../bootstrap/js/bootstrap.min.js"></script>
		<!-- iCheck -->
		<script src="../../plugins/twitter-bootstrap-wizard-master/jquery.bootstrap.wizard.js"></script>

		<script src="../../plugins/iCheck/icheck.min.js"></script>
		<script src="../../libs/placeholders.js"></script>
		<script src="../../libs/jquery.SuperSlide.2.1.1.js"></script>
		<script src="../../plugins/sweetalert/js/sweetalert.min.js"></script>
		<script src="../../libs/jQuery.md5.js"></script>
		<script>
			//  $(".slideBox").slide({mainCell:".bannerWrapper ul",effect:"leftLoop",autoPlay:true,delayTime:500});
			$(function() {
				var wait = 60;
				$('input').iCheck({
					checkboxClass: 'icheckbox_square-blue',
					radioClass: 'iradio_square-blue',
					increaseArea: '20%' // optional
				});
				$('.modal-dialog').css('width', '50%');
				$('#myModal').modal('show');

				if ($('#hidflag').val() == '1') {
					window.location.href = './login';
					//            swal("系统提示", "当前登录信息已经发生改变,请重新登录!");
				}

				$('#forgetPsw').on('click', function() {
					$('#phoneNo').val('');
					$('#newPsw').val('');
					$('#newPswAgain').val('');
					$('#regCode').val('');
					$('#msgCode').val('');
					$('#rootwizard').data('bootstrapWizard').first();
					$('#regModal').modal('show');
				});

				$('#loginOn').on('click', function() {
					$('.login-box-msg').css('visibility', 'hidden');
					var name = $('#name').val();
					var pass = $('#pass').val();
					var forms = {
						name: name,
						pass: pass
					};
					$.ajax({
						type: "POST",
						url: '/login',
						data: forms,
						dataType: "json",
						success: function(data) {
							if (data.retCode == 0) {
								var innerForm = {
									userId: data.retObj.userId
								};
								$.ajax({
									type: "POST",
									url: '/register/getUserCompList',
									data: innerForm,
									dataType: "json",
									success: function(subdata) {
										if (subdata.retCode == 0) {
											if (subdata.retObj.data.length == 1) {
												// window.location.href='/index';
											} else {
												window.location.href = '/chooseCompany';
											}
										}
									}
								});

							} else if (data.retCode == 20005) {
								swal({
										title: "系统提示",
										text: '您当前仅是手机用户不能登录后台，点击“创建”按钮进行创建',
										showCancelButton: true,
										cancleButtonColor: "DD6B55",
										confirmButtonColor: "#ff751a",
										confirmButtonText: "确定",
										closeOnConfirm: false,
										showLoaderOnConfirm: true,
										html: true
									},
									function(isConfirm) {
										if (isConfirm) {
											window.location.href = '/register?userId=' + data.retObj.userId + '&Mobile=' + name;
										}
									});
							} else {
								$('.login-box-msg').html(data.retMsg);
								$('.login-box-msg').css('visibility', 'visible');

							}
						}
					});
				});

				$('#updatePsw').on('click', function() {
					var phoneNo = $('#name').val();
					var newPsw = $('#newPsw').val();
					var newPswAgain = $('#newPswAgain').val();
					var msgCode = $('#msgCode').val();
					if (msgCode == '') {
						swal('请输入短信验证码！');
						return false;
					}

					if (newPswAgain != newPsw) {
						swal('两次输入密码不一致，请保持一致！');
						return false;
					} else {
						var forms = {
							mobile: phoneNo,
							verificationCode: msgCode
						};
						$.ajax({
							type: "POST",
							url: '/register/modifyPassword',
							data: forms,
							dataType: "json",
							success: function(data) {
								if (data.ret == 0) {
									var paras = {
										mobile: phoneNo,
										passWord: $.md5(newPsw)
									};
									$.ajax({
										type: "POST",
										url: '/register/forgotPassword',
										data: paras,
										dataType: "json",
										success: function(data) {
											if (data.retCode == 0) {
												swal('密码更改成功');
											} else {
												swal('操作失败，请稍后重试！');
											}
										}
									});
								} else {
									swal('短信验证码填写错误，请重试！');
									//                      $('#photoPop').hide();
								}
							}
						});

					}
				});

				$('.update').on('click', function() {
					var phone = $('#phoneNo').val();
					$('#codeBox').attr('src', '/register/getImgCode?mobile=' + phone);
				});

				$('#getMsgCode').on('click', function() {
					var phoneNo = $('#phoneNo').val();
					var regCode = $('#regCode').val();
					if (regCode == '') {
						swal('请填写图形验证码');
					} else {
						var paras = {
							Phone: phoneNo,
							para3: "0",
							flag: "REG",
							imgcode: regCode
						};
						$.ajax({
							type: "POST",
							url: '/register/getVerificationCode',
							data: paras,
							dataType: "json",
							success: function(data) {
								if (data.ret == 0) {
									if (data.privateimgcode == 1) {
										swal('验证码已发送,请注意查收！');
										time($('#getMsgCode'));
									}
								}
								if (data.ret == 1) {
									if (data.privateimgcode == 1) {
										swal('图像验证码错误,请重新填写!');
									} else {
										swal('发送失败，请稍后重试！');
									}
								}
							}
						});
					}
				});

				function time(o) {
					if (wait == 0) {
						o.prop('disabled', false);
						o.html("获取验证码");
						wait = 60;
						//更新图形验证码
						//$("#imgcodevs").trigger("click");
					} else {
						o.prop("disabled", true);
						o.html("已发送(" + wait + ")");
						wait--;
						setTimeout(function() {
								time(o)
							},
							1000)
					}
				}


				$('#rootwizard').bootstrapWizard({
					onTabClick: function(tab, navigation, index) {
						return false;
					},
					onTabShow: function(tab, navigation, index) {
						var $total = navigation.find('li').length;
						var $current = index + 1;
						var $percent = ($current / $total) * 100;
						$('#rootwizard').find('.bar').css({
							width: $percent + '%'
						});
					},
					onNext: function(tab, navigation, index) {
						if (index == 1) {
							var patrn = /^1[1234567890]\d{9}$/;
							var phone = $('#phoneNo').val();
							var r = phone.match(patrn);
							var type = false;
							if (!r) {
								swal('手机号格式不正确');
								return false;
							} else {
								var paras = {
									mobile: phone
								};
								$.ajax({
									type: "POST",
									url: '/register/checkMobile',
									data: paras,
									dataType: "json",
									async: false,
									success: function(data) {
										if (data.retCode == 0 && data.retObj != '') {
											$('#codeBox').attr('src', '/register/getImgCode?mobile=' + phone);
											//                                    return true;
											type = true;
										} else {
											swal('该手机号未注册，请确认手机号是否正确。');

										}
									}
								});
							}
							return type;
						}
						if (index == 2) {
							var phoneNo = $('#phoneNo').val();

							var msgCode = $('#msgCode').val();
							if (msgCode == '') {
								swal('请输入短信验证码！');
								return false;
							}
							var forms = {
								mobile: phoneNo,
								verificationCode: msgCode
							};
							var flag = false;
							$.ajax({
								type: "POST",
								url: '/register/modifyPassword',
								data: forms,
								dataType: "json",
								async: false,
								success: function(data) {
									if (data.ret == 0) {
										//                                return true;
										flag = true;
									} else {
										swal('输入短信验证码不正确！');
										return false;
									}
								}
							});
							$('#nextSteps').html('确定');
							return flag;
						}
						if (index == 3) {
							var phoneNo = $('#phoneNo').val();
							var newPsw = $('#newPsw').val();
							var newPswAgain = $('#newPswAgain').val();
							var patrn = /^[0-9a-zA-Z]{6,12}$/;
							var r = newPswAgain.match(patrn);
							var q = newPsw.match(patrn);
							if (!r || !q) {
								swal('密码格式不正确');
								return false;
							}
							if (newPswAgain != newPsw) {
								swal('两次输入密码不一致，请保持一致！');
								return false;
							}
							var paras = {
								mobile: phoneNo,
								passWord: $.md5(newPsw)
							};
							$.ajax({
								type: "POST",
								url: '/register/forgotPassword',
								data: paras,
								dataType: "json",
								success: function(data) {
									if (data.retCode == 0) {
										swal('密码更改成功');
										$('#regModal').modal('hide');
									} else {
										swal('操作失败，请稍后重试！');
									}
								}
							});
						}

					},
					onPrevious: function(tab, navigation, index) {
						if (index == 0) {
							$('#nextSteps').html('下一步');
							//                    $("#upli").css('display', 'none');
						}
						if (index == 1) {
							$('#nextSteps').attr("disabled", false);
							$('#nextSteps').html('下一步');
						}
						if (index == 2) {
							$('#nextSteps').attr("disabled", false);
							$('#nextSteps').html('确定');
						}

					},
					//            onInit: function () {
					//                alert('2233r');
					//            }
				});

			});
		</script>
	</body>
</html>
